language: java
jdk: oraclejdk8
services:
- docker
before_install:
- docker run  -d --name rabbit -p 5672:5672 rabbitmq:3.6
install: true
script:
- curl ifconfig.co
- if [[ $TRAVIS_COMMIT_MESSAGE != 'JENKINS SNAPSHOT UPDATE' ]]; then ./gradlew build
  --info; fi
env:
  global:
  - SPRING_PROFILES_ACTIVE=default,integration-tests
  - secure: aFrPp5EJ+7o+HAJZzdkafHzpFOIO5+DTf3PzB9qh/fko5tpzcfVqVolFYRqngWKhbZ2pFSpAMcdD26/RIpIsMw2PzVoYZzLx3kHDbR2re2ip3uBktWMpd+8TKsPDhqi89AqLXwMY8t3kLLQgPePc9Cb7KIYl14fy4B2JNe45aSy0DbytNbgyZa9EyUpXJu+RjBanis4/R/e14UxhAoE3xPOwk89H5kdNh45a7HYrxudhk24kXgRBywqv7Jt7xb2GOjKkjKoT68LYPO+HOY+U+cYL1LsXPhumMU8GSaBduG8mQRBou3AqObJSBK3a+Pw2V9YPRJvw1kjN4fxkI4YzxZox2dPHAACFSxV6fLirh86aaQ1mLSLzwhbohw9RxpAUmn9mjm8msAf0YXoo2759sfUylMrZ1kk4D8rl2HO+WWHA4Q7gPSWzJIAgkAnYDTwE5IrbUiBxhhiVYeOpdckfU6DdrK2UZheFwUkmkHgYh67/hZJHMVdjhGQUSRKNfx/X6U7panYfknifaPa9Y6zF01Pm8I7e2sk1iCEGxsKDpjenI54qXabGoI7VROur1Gu/r3u774rcAfwZ8wqI2NT01kkwwC1pF4O3PALS0S8/7nPeQHg9Ox+dJp5OaqhquEbJvsgF1auiH9eQzMlq6CudiY90gKLao9zjKgmoofuMVXA=
  - secure: BXQOGP7UEYLl74ThhA5Sg7LS0uDK5EH9yHFVdu5RxQfWDeVcYD+VAwPeZ4cz4I8EoY7hIL0kQQu9utUe7MsZJdqjxRVde4qSdqHjY08gwf72IOHCl7/ZiKM6zLckpXjm9Usn3nyLIXs6Cm1doWrlNOdhLjlWnQQbVwilTO/PY5Wmaqi37qBSs0EiOCt2zPJGdmP8uIbnI3rrtmVoIHPJ7BtigN8mm/65HaTGgsz48+nMAVSP5bHSWEXTYEi3wStT4mRI9KzQ9fVrCAb6txd/S9zt8oOYHjAIrzKN7rnHbdfe+/K8eHPeBR2E2AhNYelBISewKf677ZHzX5PGZ8q3c3DXHG47FlihIkDfL7ci5hLLGiCd/pXqnfglj9VKYakoSOmWLWZBmYIraICMaEzqYLbTJ1aTOdaAOgpzrrGhtMA4b27X+qj1shDZoJ55UCB6bbCbrUmC7cGKz9Fx+nq1vgNtsWRO0J1lfTV+ZuBIJPmjXq2mfUFBcMxwzLAlF7cz9MgpZIGcH4xieVAmN3laa/r2uJJX7D1eHiIO1I9iJTA+yhLuMPoyq69H+JlQxiDJn+lB7BCZGX/eyBluvkG6Y18ixW6DxpQGBGhzScn7EvO1BIX3RbdKE3naQCVHTKQ/ztgY6txdI3DYoz1DaNUHfGk4QMgDunTMAgsCfzRuCjk=
  - secure: ZGTvwlqFcS3SxD1v2wKuRwgypdBtDo96B9rPvDin2l4eQ6DEhdBqQpy/45LJnQ3FD61TcA6mYbVatp7TE6nb0Vr2Pu+eTJ6TgywKexBT1CUzhIWXqxR/z8j1qvySv2Krr8MtbKMtoq3tgafi1Oe5RDLqyPHSB4MshXmXRxcqFr5OJdyaSUuKhmLqf0pKvAZG65QM3hhMR5O/lkmR515dGYnRG9vCZZeSk2sbQMy8y5zsyexZq4ocg07/1782Kpj/mHDicXaJFizIZtGmWi8T9xsrG+LuvOiIQmv39qVLZQvD/hSEFyZ0tS7Wmu3wNzeWn8rNalEhXhP3+kAdYctPF4x+mbBYjg00qiat3AlfW/qPlLgieMny00jY6j93/sZrio2pM4VLgPzLHyR4r7xV5Uwr5ocvcIoy14mnpm7VOEKMScxwYIXddZe4dODh7s2/3SJzz5vHxK1eu2U3d3k1+dJ2pYscxns7jSg1MYBN8OBhlFH3j5BCjalyc9EVieejVPNFIKY/YbfHRoVhsWAbXroZVZhHEU2BzjorIgPeQESlMoOn1OSAI8XOblHTv/RDACRs603+K8eHFmttBr2USvcpOOtfhRWQN0o94K7h4EEb8QVypDmCJWNF19txvY7BSaZsDEhmPgzvmIocg9L7DrCrqeQ80EiTI/jkLMbUxw4=
  - secure: ZCZ/nqqcqk0BlZVPFQvpreAjnawmiqymaRocrk/KWr4Hexh1pxtj+2bZWXe73bQ1RXbPh5ddSEMVm8XOfxfP/JvCZjdCt0KcMwODj7vSDKS+auZqWbc0SaTQ/u1qDmvG4KSOamIG+njMp1htMaxntxUHM+FtxXV104ByP5ezC1bRJiSNnXoOMcxlebTxhPi2De4hpx5l75emEEtbZUWJ11wgV+q6Qc6Tdk6z2/4zHVvCc2NdCgSaqApHHaseVA2Wefak8oWYLjoR1PLBRA+58uJT8okIgs6MIeCruDb7Q6hakU73yDv4wMWXKHIcme9YorsxPXsiCECaZwSxvSPHS8ini6i6YSsjoem2r1qEVzXULK4mY5nkozMKYm7vMdIxXbykNleRRwi9RvrWVrVW6UBJZMD6okDf7e9nmi1H7KAOzYq4qzB1HS8PfK6ZZigwxvfKyLqOym1VQwf9Da7LwdhXI7CZHMardu8Z9YL6HYrChKRw1g2pcFfhBjmRjELrInMfSuPr0oVaw0igRoPekDobwNc4bGUHDz/Wt0PCoUs6+m5hr2QqGpsC+C6ZHcFhi1KbkeAL6IQiFtQC8eRXW1fpcd5iH4IbXlN2aMjRhS5prTigwtQm1ZhbV03q5ctCrFIJ+dtbJ8fP/yFEMPrBInONUMN7CmTRgYACISwEtsQ=
  - secure: SIMNFpn5w89bEFPdoZTZvNgV7HN34WpwqpEBNTSTVqLs/0LnKj864NELCEQ0nfFxmv1QXWoE5DT/lYix35RIk8IOE3c2Q5CsFpJXa5bSHrAivuckStfo69RB9AQoAh4p2Iq+ivU4RwAJrzOfG9hENGRiahlkbymNBcabU97YZOw5ctlcA7Ufhvs7CWOKLuHsgG4qLi4g9F0hLm1uOth8aXEGqtgfdRmPNSSGoM2TDWGZu8VrArkIwtmRdo+/Wkv1jemgrreyMBi5+eD5r4f9xRBgmPglLgWTTw5IeaRNeUopvKkb5eaYZE6nCxT00/a9J2kBH32wwbA4peNBvALnNS00sRTwIJGEOSOFqUADnk1sOr0FmnLNnsRXs8SeYxvosP7e/xB+naHOWQN8svNrdKNs/MuMC6AuYURw+yRoXOUoHeGnvV+lr8ds7lI9gaqTYOAFh5/+AvBg+aupZNIsXjX4g2g3RnRPnVOqMcIKGwwaUhd0Y+zQWziDYU7mvSjk+6WEKxO6cVUUUi+L8REAtCJfFgAyfuq02NyysQ6l8l9tBtPeZgwpmO5AQk/+fiO1pJ8jdc+ujjudDt7aFZf1CfGB8bzMaC0Nl33D7r5tzfx8HtqzdybjNeXEWxrm1s62TxlzOAbZBbJp2PRc4qhqLGJCvEIohYGUh3K/2vaeIKw=
branches:
  only:
  - master
notifications:
  slack:
    secure: qv9PEK9fWuKJpeTabAvgMM1/I7NO2IsexfpYVNh/ZfbikOku5xAU6KJoepYOByB2Xd5/aLGM8NXmEt5LH19LHSKzNeb5JqoFU2OCkXV93U5WXPV175isUzABfJC7N/ZKb2m9tWc6Rjp+WEEBH736WgrqMGdmELO2VEcEOukSa+IszOGhn5RhQLMLuzrkW2JdmWBVnIHStotGa7By+hxEqRgUNhVaiHj1y7fDtctPjfGklMbETOy6CuqRT7DeGwi0u6PWZs3mIuRzRVfsw/3nuU1axA8+sSEd2z0i8c3nELtZ1RH7Si+D9aQ7TEkVNJFcE2zcpMAi+5QKxoO4xu/RR7XNpIXHZfGl3kotbLtZGkL/kpTs1g6eZAlwOX0WtgyXnnRvH3YxE9ROGaTin9bWBMarFxavHJbMO8qwXrXLRafEPT437GxcNL7UaAdCM/ELRnelDIhnbC1fmeSkHfN9W1wdHWyi8xuaANJtsXVPPmBYDmByU5l7hsLwgyiv7fUDGNfxSXJf7QOZKLEKTYEpea3F6fbWzyKCv6S0MJWM7v7o/pG4T82DKCXWWOfQppFnwe0fNYJmXWGgT1/hmTZzhiPeGm0O83AA6gP5vT+k1zKxKXvvjI6Ohh5aA2BpESkxEhGGCvkzLCeQXo3VeSu4SOgMaPYT/TGc9Emnd4CQjbo=
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
after_success:
- bash <(curl -s https://codecov.io/bash)
- if [[ "$TRAVIS_BRANCH" = "master" ]] && [[ "$TRAVIS_PULL_REQUEST" = "false" ]] && [[ $TRAVIS_COMMIT_MESSAGE != "JENKINS SNAPSHOT UPDATE" ]];
  then echo "$DOCKER_PASSWORD" | docker login --username "$DOCKER_USERNAME" --password-stdin;
  docker build -t sdcplatform/fwmtjobsvcv2 -t sdcplatform/fwmtjobsvcv2:job-service-$TRAVIS_BUILD_NUMBER --build-arg jar=build/libs/fwmt-job-service-v2-*.jar .;
  docker push sdcplatform/fwmtjobsvcv2;
  ./gradlew artifactPublish;
  fi
